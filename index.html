<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048</title>
<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }
    #game-container {
        width: 320px;
        text-align: center;
        color: white;
    }
    #scoreboard {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 1.2em;
    }
    #board {
        display: grid;
        grid-template-columns: repeat(4, 70px);
        grid-gap: 5px;
        background: rgba(255,255,255,0.1);
        padding: 5px;
        border-radius: 10px;
    }
    .tile {
        width: 70px;
        height: 70px;
        background: rgba(255,255,255,0.3);
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 24px;
        font-weight: bold;
        border-radius: 5px;
    }
    #controls {
        margin-top: 10px;
    }
    .btn {
        width: 60px;
        height: 60px;
        font-size: 24px;
        margin: 5px;
        border: none;
        border-radius: 10px;
        background: rgba(255,255,255,0.2);
        color: white;
    }
</style>
</head>
<body>
<div id="game-container">
    <div id="scoreboard">
        <div>Счет: <span id="score">0</span></div>
        <div>Макс: <span id="best">0</span></div>
    </div>
    <div id="board"></div>
    <div id="controls">
        <div>
            <button class="btn" id="up">↑</button>
        </div>
        <div>
            <button class="btn" id="left">←</button>
            <button class="btn" id="down">↓</button>
            <button class="btn" id="right">→</button>
        </div>
    </div>
</div>

<script>
const boardSize = 4;
let board = [];
let score = 0;
let best = localStorage.getItem('best') || 0;

const boardDiv = document.getElementById('board');
const scoreSpan = document.getElementById('score');
const bestSpan = document.getElementById('best');
bestSpan.textContent = best;

// Инициализация пустой доски
function initBoard() {
    board = [];
    for(let i=0;i<boardSize;i++){
        board.push(Array(boardSize).fill(0));
    }
    addRandomTile();
    addRandomTile();
    updateBoard();
}

// Добавление новой плитки
function addRandomTile(){
    let empty = [];
    for(let i=0;i<boardSize;i++){
        for(let j=0;j<boardSize;j++){
            if(board[i][j]===0) empty.push([i,j]);
        }
    }
    if(empty.length===0) return;
    let [x,y] = empty[Math.floor(Math.random()*empty.length)];
    board[x][y] = Math.random()<0.9?2:4;
}

// Обновление доски на экране
function updateBoard(){
    boardDiv.innerHTML = '';
    for(let i=0;i<boardSize;i++){
        for(let j=0;j<boardSize;j++){
            let tile = document.createElement('div');
            tile.classList.add('tile');
            if(board[i][j]!==0) tile.textContent = board[i][j];
            boardDiv.appendChild(tile);
        }
    }
    scoreSpan.textContent = score;
    bestSpan.textContent = best;
}

// Сдвиг и объединение
function slide(row){
    let arr = row.filter(val=>val);
    for(let i=0;i<arr.length-1;i++){
        if(arr[i]===arr[i+1]){
            arr[i]*=2;
            score+=arr[i];
            if(score>best) {
                best=score;
                localStorage.setItem('best', best);
            }
            arr[i+1]=0;
        }
    }
    arr = arr.filter(val=>val);
    while(arr.length<boardSize) arr.push(0);
    return arr;
}

// Движение
function move(direction){
    let rotated = false;
    let moved = false;

    function rotateBoard(){
        let newBoard = [];
        for(let i=0;i<boardSize;i++){
            newBoard.push([]);
            for(let j=0;j<boardSize;j++){
                newBoard[i][j]=board[j][i];
            }
        }
        board = newBoard;
    }

    switch(direction){
        case 'up':
            rotateBoard();
            for(let i=0;i<boardSize;i++){
                let col = board[i].slice();
                let newCol = slide(col);
                if(col.toString()!==newCol.toString()) moved=true;
                board[i]=newCol;
            }
            rotateBoard();
            break;
        case 'down':
            rotateBoard();
            for(let i=0;i<boardSize;i++){
                let col = board[i].slice().reverse();
                let newCol = slide(col).reverse();
                if(col.reverse().toString()!==newCol.toString()) moved=true;
                board[i]=newCol;
            }
            rotateBoard();
            break;
        case 'left':
            for(let i=0;i<boardSize;i++){
                let row = board[i].slice();
                let newRow = slide(row);
                if(row.toString()!==newRow.toString()) moved=true;
                board[i]=newRow;
            }
            break;
        case 'right':
            for(let i=0;i<boardSize;i++){
                let row = board[i].slice().reverse();
                let newRow = slide(row).reverse();
                if(row.reverse().toString()!==newRow.toString()) moved=true;
                board[i]=newRow;
            }
            break;
    }

    if(moved) addRandomTile();
    updateBoard();
}

// Кнопки управления
document.getElementById('up').addEventListener('click', ()=>move('up'));
document.getElementById('down').addEventListener('click', ()=>move('down'));
document.getElementById('left').addEventListener('click', ()=>move('left'));
document.getElementById('right').addEventListener('click', ()=>move('right'));

// Свайпы для мобильных
let touchStartX=0, touchStartY=0;
document.addEventListener('touchstart', e=>{
    touchStartX = e.changedTouches[0].screenX;
    touchStartY = e.changedTouches[0].screenY;
});
document.addEventListener('touchend', e=>{
    let dx = e.changedTouches[0].screenX - touchStartX;
    let dy = e.changedTouches[0].screenY - touchStartY;
    if(Math.abs(dx)>Math.abs(dy)){
        if(dx>0) move('right'); else move('left');
    }else{
        if(dy>0) move('down'); else move('up');
    }
});

// Инициализация
initBoard();
</script>
</body>
</html>
