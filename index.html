<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048 Telegram Web App</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    margin: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #fff;
  }
  h1 { margin-top: 20px; }
  .score-board {
    display: flex;
    gap: 20px;
    margin: 10px 0;
  }
  .score, .best {
    font-size: 1.2em;
    padding: 5px 15px;
    background: rgba(0,0,0,0.2);
    border-radius: 5px;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(4, 80px);
    grid-template-rows: repeat(4, 80px);
    gap: 10px;
    margin-top: 20px;
  }
  .tile {
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 24px;
    border-radius: 10px;
    color: #fff;
    user-select: none;
  }
</style>
</head>
<body>
<h1>2048</h1>
<div class="score-board">
  <div class="score">Score: <span id="score">0</span></div>
  <div class="best">Best: <span id="best">0</span></div>
</div>
<div id="grid"></div>
<script>
const SIZE = 4;
let grid = [];
let score = 0;
let best = localStorage.getItem('best') || 0;
document.getElementById('best').innerText = best;

const colors = {
  2: '#eee4da',
  4: '#ede0c8',
  8: '#f2b179',
  16: '#f59563',
  32: '#f67c5f',
  64: '#f65e3b',
  128: '#edcf72',
  256: '#edcc61',
  512: '#edc850',
  1024: '#edc53f',
  2048: '#edc22e',
  'super': '#3c3a32'
};

function initGrid() {
  grid = Array(SIZE).fill().map(() => Array(SIZE).fill(0));
  addTile();
  addTile();
  drawGrid();
}

function drawGrid() {
  const gridDiv = document.getElementById('grid');
  gridDiv.innerHTML = '';
  for (let r = 0; r < SIZE; r++) {
    for (let c = 0; c < SIZE; c++) {
      const val = grid[r][c];
      const tile = document.createElement('div');
      tile.className = 'tile';
      tile.textContent = val ? val : '';
      const bg = colors[val] || colors['super'];
      tile.style.backgroundColor = bg;
      tile.style.color = val <= 4 ? '#776e65' : '#fff';
      gridDiv.appendChild(tile);
    }
  }
  document.getElementById('score').innerText = score;
  document.getElementById('best').innerText = best;
}

function addTile() {
  const empty = [];
  for (let r = 0; r < SIZE; r++)
    for (let c = 0; c < SIZE; c++)
      if (grid[r][c] === 0) empty.push([r,c]);
  if (empty.length === 0) return;
  const [r,c] = empty[Math.floor(Math.random()*empty.length)];
  grid[r][c] = Math.random() < 0.9 ? 2 : 4;
}

function slide(row) {
  const arr = row.filter(v => v);
  for (let i = 0; i < arr.length-1; i++) {
    if (arr[i] === arr[i+1]) {
      arr[i] *= 2;
      score += arr[i];
      if(score > best){best=score; localStorage.setItem('best',best);}
      arr[i+1] = 0;
    }
  }
  return arr.filter(v => v).concat(Array(SIZE-arr.filter(v => v).length).fill(0));
}

function rotateGrid(clockwise=true) {
  const newGrid = Array(SIZE).fill().map(()=>Array(SIZE).fill(0));
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      if(clockwise) newGrid[c][SIZE-1-r]=grid[r][c];
      else newGrid[SIZE-1-c][r]=grid[r][c];
    }
  }
  grid=newGrid;
}

function move(dir) {
  let old = grid.map(r=>r.slice());
  if(dir==='up'){ rotateGrid(false); for(let i=0;i<SIZE;i++) grid[i]=slide(grid[i]); rotateGrid(); }
  if(dir==='down'){ rotateGrid(false); for(let i=0;i<SIZE;i++) grid[i]=slide(grid[i].reverse()).reverse(); rotateGrid(); }
  if(dir==='left'){ for(let i=0;i<SIZE;i++) grid[i]=slide(grid[i]); }
  if(dir==='right'){ for(let i=0;i<SIZE;i++) grid[i]=slide(grid[i].reverse()).reverse(); }
  if(JSON.stringify(old) !== JSON.stringify(grid)) { addTile(); drawGrid(); checkGameOver(); }
}

function checkGameOver() {
  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      if(grid[r][c]===0) return;
      if(c<SIZE-1 && grid[r][c]===grid[r][c+1]) return;
      if(r<SIZE-1 && grid[r][c]===grid[r+1][c]) return;
    }
  }
  alert('Game Over! Final score: '+score);
}

document.addEventListener('keydown', e=>{
  if(e.key==='ArrowUp') move('up');
  if(e.key==='ArrowDown') move('down');
  if(e.key==='ArrowLeft') move('left');
  if(e.key==='ArrowRight') move('right');
});

// Touch controls for mobile
let startX=0, startY=0;
document.addEventListener('touchstart', e=>{
  const t=e.touches[0];
  startX=t.clientX;
  startY=t.clientY;
});
document.addEventListener('touchend', e=>{
  const t=e.changedTouches[0];
  let dx=t.clientX-startX;
  let dy=t.clientY-startY;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>30) move('right'); 
    else if(dx<-30) move('left');
  }else{
    if(dy>30) move('down');
    else if(dy<-30) move('up');
  }
});

initGrid();
</script>
</body>
</html>
