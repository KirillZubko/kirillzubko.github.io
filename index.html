<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>2048</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: Arial, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    min-height: 100vh;
    margin: 0;
    padding: 20px 0;
  }

  h1 {
    color: white;
    margin-bottom: 10px;
  }

  #score-board {
    color: white;
    margin-bottom: 15px;
    font-size: 18px;
  }

  #game-container {
    background: #bbada0;
    padding: 15px;
    border-radius: 10px;
    display: grid;
    grid-template-columns: repeat(4, 70px);
    grid-gap: 10px;
    touch-action: none;
  }

  .tile {
    width: 70px;
    height: 70px;
    background: #cdc1b4;
    border-radius: 5px;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: 20px;
    font-weight: bold;
    color: #776e65;
  }
  .tile-2 { background: #eee4da; }
  .tile-4 { background: #ede0c8; }
  .tile-8 { background: #f2b179; color: #f9f6f2; }
  .tile-16 { background: #f59563; color: #f9f6f2; }
  .tile-32 { background: #f67c5f; color: #f9f6f2; }
  .tile-64 { background: #f65e3b; color: #f9f6f2; }
  .tile-128 { background: #edcf72; color: #f9f6f2; }
  .tile-256 { background: #edcc61; color: #f9f6f2; }
  .tile-512 { background: #edc850; color: #f9f6f2; }
  .tile-1024 { background: #edc53f; color: #f9f6f2; }
  .tile-2048 { background: #edc22e; color: #f9f6f2; }

  #controls {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
  }

  .btn {
    background: rgba(255,255,255,0.8);
    border: none;
    padding: 15px 20px;
    border-radius: 8px;
    font-size: 20px;
    font-weight: bold;
    color: #333;
    cursor: pointer;
    user-select: none;
  }
</style>
</head>
<body>
<h1>2048</h1>
<div id="score-board">Счет: 0 | Рекорд: 0</div>
<div id="game-container"></div>

<div id="controls">
  <button class="btn" id="up">↑</button>
  <button class="btn" id="left">←</button>
  <button class="btn" id="down">↓</button>
  <button class="btn" id="right">→</button>
</div>

<script>
window.onload = function() {
  const size = 4;
  let board = [];
  let score = 0;
  let maxScore = 0;

  function initBoard() {
    board = Array(size).fill().map(() => Array(size).fill(0));
    score = 0;
    addRandomTile();
    addRandomTile();
    drawBoard();
    updateScore();
  }

  function addRandomTile() {
    const empty = [];
    for (let r = 0; r < size; r++) {
      for (let c = 0; c < size; c++) {
        if (board[r][c] === 0) empty.push([r, c]);
      }
    }
    if (empty.length === 0) return;
    const [r, c] = empty[Math.floor(Math.random() * empty.length)];
    board[r][c] = Math.random() < 0.9 ? 2 : 4;
  }

  function drawBoard() {
    const c = document.getElementById('game-container');
    c.innerHTML = '';
    for (let r = 0; r < size; r++) {
      for (let col = 0; col < size; col++) {
        const tile = document.createElement('div');
        tile.classList.add('tile');
        if (board[r][col] > 0) tile.classList.add(`tile-${board[r][col]}`);
        tile.textContent = board[r][col] === 0 ? '' : board[r][col];
        c.appendChild(tile);
      }
    }
  }

  function slide(row) {
    row = row.filter(v => v !== 0);
    for (let i = 0; i < row.length - 1; i++) {
      if (row[i] === row[i + 1]) {
        row[i] *= 2;
        score += row[i];
        row[i + 1] = 0;
      }
    }
    row = row.filter(v => v !== 0);
    while (row.length < size) row.push(0);
    return row;
  }

  function rotateBoard() {
    const newBoard = Array(size).fill().map(() => Array(size).fill(0));
    for (let r = 0; r < size; r++) {
      for (let c = 0; c < size; c++) {
        newBoard[c][size - 1 - r] = board[r][c];
      }
    }
    board = newBoard;
  }

  function moveLeft() { board = board.map(slide); addRandomTile(); drawBoard(); updateScore(); }
  function moveRight() { board = board.map(row => slide(row.reverse()).reverse()); addRandomTile(); drawBoard(); updateScore(); }
  function moveUp() { rotateBoard(); moveLeft(); rotateBoard(); rotateBoard(); rotateBoard(); }
  function moveDown() { rotateBoard(); rotateBoard(); rotateBoard(); moveLeft(); rotateBoard(); }

  function updateScore() {
    if (score > maxScore) maxScore = score;
    document.getElementById('score-board').textContent = `Счет: ${score} | Рекорд: ${maxScore}`;
  }

  document.addEventListener('keydown', e => {
    switch (e.key) {
      case 'ArrowLeft': moveLeft(); break;
      case 'ArrowRight': moveRight(); break;
      case 'ArrowUp': moveUp(); break;
      case 'ArrowDown': moveDown(); break;
    }
  });

  // Кнопки для сенсорных устройств
  document.getElementById('up').onclick = moveUp;
  document.getElementById('down').onclick = moveDown;
  document.getElementById('left').onclick = moveLeft;
  document.getElementById('right').onclick = moveRight;

  // Сенсорные свайпы
  let touchStartX = 0;
  let touchStartY = 0;

  document.getElementById('game-container').addEventListener('touchstart', e => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;
  });

  document.getElementById('game-container').addEventListener('touchend', e => {
    const dx = e.changedTouches[0].clientX - touchStartX;
    const dy = e.changedTouches[0].clientY - touchStartY;
    if (Math.abs(dx) > Math.abs(dy)) {
      if (dx > 20) moveRight();
      else if (dx < -20) moveLeft();
    } else {
      if (dy > 20) moveDown();
      else if (dy < -20) moveUp();
    }
  });

  initBoard();
};
</script>
</body>
</html>
