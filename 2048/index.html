<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>2048 Mobile</title>
<style>
    body {
        font-family: 'Arial', sans-serif;
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        margin: 0;
        padding: 20px;
        height: 100vh;
        box-sizing: border-box;
    }
    #scoreboard {
        color: white;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 10px;
        text-align: center;
    }
    #game-container {
        display: grid;
        grid-template-columns: repeat(4, 70px);
        grid-template-rows: repeat(4, 70px);
        gap: 8px;
        background: rgba(255,255,255,0.2);
        padding: 8px;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    .cell {
        width: 70px;
        height: 70px;
        background: rgba(255,255,255,0.3);
        border-radius: 5px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 20px;
        font-weight: bold;
        transition: background 0.3s, transform 0.2s;
    }
    .controls {
        display: grid;
        grid-template-columns: repeat(3, 60px);
        grid-template-rows: repeat(2, 60px);
        gap: 10px;
        justify-content: center;
        margin-bottom: 15px;
    }
    .controls button {
        width: 60px;
        height: 60px;
        font-size: 24px;
        border: none;
        border-radius: 5px;
        background: #ffffffaa;
        cursor: pointer;
        font-weight: bold;
    }
    #restart-btn {
        padding: 10px 20px;
        font-size: 18px;
        border: none;
        border-radius: 5px;
        background: #ffffffcc;
        font-weight: bold;
        cursor: pointer;
    }
</style>
</head>
<body>

<div id="scoreboard">
    Счет: <span id="score">0</span> | Рекорд: <span id="best">0</span>
</div>

<div id="game-container"></div>

<div class="controls">
    <div></div>
    <button onclick="move('up')">↑</button>
    <div></div>
    <button onclick="move('left')">←</button>
    <div></div>
    <button onclick="move('right')">→</button>
    <div></div>
    <button onclick="move('down')">↓</button>
    <div></div>
</div>

<button id="restart-btn" onclick="startGame()">Начать заново</button>

<script>
const container = document.getElementById('game-container');
const scoreEl = document.getElementById('score');
const bestEl = document.getElementById('best');

let board = [];
let score = 0;
let best = localStorage.getItem('best2048') || 0;

// Цвета плиток
const colors = {
    0: 'rgba(255,255,255,0.3)',
    2: '#eee4da',
    4: '#ede0c8',
    8: '#f2b179',
    16: '#f59563',
    32: '#f67c5f',
    64: '#f65e3b',
    128: '#edcf72',
    256: '#edcc61',
    512: '#edc850',
    1024: '#edc53f',
    2048: '#edc22e',
    4096: '#3c3a32'
};

function createBoard() {
    container.innerHTML = '';
    board = [];
    for (let i=0; i<4; i++) {
        board[i] = [];
        for (let j=0; j<4; j++) {
            board[i][j] = 0;
            const cell = document.createElement('div');
            cell.classList.add('cell');
            container.appendChild(cell);
        }
    }
    addRandom();
    addRandom();
    updateBoard();
}

function addRandom() {
    let empty = [];
    for (let i=0;i<4;i++){
        for (let j=0;j<4;j++){
            if(board[i][j] === 0) empty.push({i,j});
        }
    }
    if(empty.length === 0) return;
    let spot = empty[Math.floor(Math.random()*empty.length)];
    board[spot.i][spot.j] = Math.random()<0.9 ? 2 : 4;
}

function updateBoard() {
    const cells = document.querySelectorAll('.cell');
    let k = 0;
    for (let i=0;i<4;i++){
        for (let j=0;j<4;j++){
            const val = board[i][j];
            cells[k].textContent = val === 0 ? '' : val;
            cells[k].style.background = colors[val] || '#3c3a32';
            cells[k].style.color = val>4 ? '#fff' : '#776e65';
            k++;
        }
    }
    scoreEl.textContent = score;
    bestEl.textContent = best;
}

function slide(row) {
    let arr = row.filter(v=>v);
    for (let i=0;i<arr.length-1;i++){
        if(arr[i] === arr[i+1]){
            arr[i]*=2;
            score += arr[i];
            if(score>best) {
                best = score;
                localStorage.setItem('best2048', best);
            }
            arr[i+1]=0;
        }
    }
    arr = arr.filter(v=>v);
    while(arr.length<4) arr.push(0);
    return arr;
}

function rotate(board){
    let newBoard = [];
    for (let i=0;i<4;i++){
        newBoard[i] = [];
        for (let j=0;j<4;j++){
            newBoard[i][j] = board[j][i];
        }
    }
    return newBoard;
}

function move(dir){
    let moved=false;
    if(dir==='left'){
        for(let i=0;i<4;i++){
            let row = slide(board[i]);
            if(row.toString() !== board[i].toString()) moved=true;
            board[i] = row;
        }
    } else if(dir==='right'){
        for(let i=0;i<4;i++){
            let row = slide(board[i].slice().reverse()).reverse();
            if(row.toString() !== board[i].toString()) moved=true;
            board[i] = row;
        }
    } else if(dir==='up'){
        board = rotate(board);
        for(let i=0;i<4;i++){
            let row = slide(board[i]);
            if(row.toString() !== board[i].toString()) moved=true;
            board[i] = row;
        }
        board = rotate(board);
    } else if(dir==='down'){
        board = rotate(board);
        for(let i=0;i<4;i++){
            let row = slide(board[i].slice().reverse()).reverse();
            if(row.toString() !== board[i].toString()) moved=true;
            board[i] = row;
        }
        board = rotate(board);
    }
    if(moved){
        addRandom();
        updateBoard();
        if(gameOver()) setTimeout(()=>alert('Игра окончена!'),50);
    }
}

function gameOver(){
    for(let i=0;i<4;i++){
        for(let j=0;j<4;j++){
            if(board[i][j]===0) return false;
            if(j<3 && board[i][j]===board[i][j+1]) return false;
            if(i<3 && board[i][j]===board[i+1][j]) return false;
        }
    }
    return true;
}

// Keyboard
document.addEventListener('keydown', e=>{
    if(e.key==='ArrowUp') move('up');
    if(e.key==='ArrowDown') move('down');
    if(e.key==='ArrowLeft') move('left');
    if(e.key==='ArrowRight') move('right');
});

// Touch (mobile)
let startX, startY;
document.addEventListener('touchstart', e=>{
    const t = e.touches[0];
    startX = t.clientX;
    startY = t.clientY;
});
document.addEventListener('touchend', e=>{
    const t = e.changedTouches[0];
    let dx = t.clientX - startX;
    let dy = t.clientY - startY;
    if(Math.abs(dx)>Math.abs(dy)){
        if(dx>30) move('right');
        else if(dx<-30) move('left');
    } else {
        if(dy>30) move('down');
        else if(dy<-30) move('up');
    }
});

function startGame(){
    score=0;
    createBoard();
}

startGame();
</script>

</body>
</html>
